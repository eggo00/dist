var B=Object.defineProperty;var W=(r,e,t)=>e in r?B(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>W(r,typeof e!="symbol"?e+"":e,t);import{V as N,B as O,G as I,a as w,M as S,b as l,S as A,C,c as T,d as G,O as z,e as v,T as Y,R as X,f as $,F as V,P as K,W as j,g as J,H as Z,D as q,h as Q}from"./three-C8A5Y40v.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const o={LANE_COUNT:3,LANE_WIDTH:3,LANE_POSITIONS:[3,0,-3],PLAYER_START_LANE:1,PLAYER_HEIGHT:1,PLAYER_RADIUS:.5,JUMP_FORCE:12,GRAVITY:-30,SLIDE_DURATION:.6,SLIDE_HEIGHT:.5,LANE_SWITCH_SPEED:15,BASE_SPEED:15,MAX_SPEED:40,SPEED_INCREMENT:.5,SPEED_INCREMENT_INTERVAL:10,SEGMENT_LENGTH:20,SEGMENTS_AHEAD:5,INITIAL_SEGMENTS:8,COIN_VALUE:10,FISH_VALUE:50,MAGNET_DURATION:10,MULTIPLIER_DURATION:15,SHIELD_DURATION:8,OBSTACLE_BASE_PROBABILITY:.4,OBSTACLE_MAX_PROBABILITY:.7,DIFFICULTY_CURVE_RATE:.02,CAMERA_FOV:60,CAMERA_NEAR:.1,CAMERA_FAR:1e3,CAMERA_OFFSET_Y:3.5,CAMERA_OFFSET_Z:-8,CAMERA_LOOK_AHEAD:5,MAX_POOL_SIZE:50,SHADOW_MAP_SIZE:1024,ENABLE_SHADOWS:!0,COMBO_TIMEOUT:2e3,SCORE_PER_METER:1},g="/cat_runrun",f={MODELS:{CAT:`${g}/models/cat.glb`,OBSTACLE_BARREL:`${g}/models/barrel.glb`,OBSTACLE_CRATE:`${g}/models/crate.glb`,OBSTACLE_HURDLE:`${g}/models/hurdle.glb`,COIN:`${g}/models/coin.glb`,FISH:`${g}/models/fish.glb`,POWERUP_MAGNET:`${g}/models/magnet.glb`,POWERUP_MULTIPLIER:`${g}/models/multiplier.glb`,POWERUP_SHIELD:`${g}/models/shield.glb`},TEXTURES:{GROUND:`${g}/textures/ground.png`,SKY:`${g}/textures/sky.png`},SOUNDS:{JUMP:`${g}/sounds/jump.wav`,COIN:`${g}/sounds/coin.wav`,FISH:`${g}/sounds/fish.wav`,HIT:`${g}/sounds/hit.wav`,POWERUP:`${g}/sounds/powerup.wav`,BGM:`${g}/sounds/bgm-temp.wav`}},m={GROUND:9488021,SKY_TOP:8900331,SKY_BOTTOM:14743295,OBSTACLE:9127187,COIN:16766720,FISH:16738740,POWERUP_MAGNET:4286945,POWERUP_MULTIPLIER:16729344,POWERUP_SHIELD:52945},y={RUN:"run",JUMP:"jump",SLIDE:"slide",HIT:"hit"};var E=(r=>(r.MENU="menu",r.PLAYING="playing",r.PAUSED="paused",r.GAME_OVER="gameOver",r.LOADING="loading",r))(E||{}),u=(r=>(r.MAGNET="magnet",r.MULTIPLIER="multiplier",r.SHIELD="shield",r))(u||{}),M=(r=>(r.LOW="low",r.MIDDLE="middle",r.HIGH="high",r))(M||{}),d=(r=>(r.COIN="coin",r.FISH="fish",r.POWERUP_MAGNET="powerup_magnet",r.POWERUP_MULTIPLIER="powerup_multiplier",r.POWERUP_SHIELD="powerup_shield",r))(d||{});class ee{constructor(e){n(this,"mesh");n(this,"state");n(this,"slideTimer",0);n(this,"boundingBox");n(this,"radius");this.state={lane:o.PLAYER_START_LANE,targetLane:o.PLAYER_START_LANE,position:new N(o.LANE_POSITIONS[o.PLAYER_START_LANE],o.PLAYER_HEIGHT,0),velocity:new N(0,0,0),isJumping:!1,isSliding:!1,isInvincible:!1,currentAnimation:y.RUN},this.mesh=this.createPlaceholderCat(),this.mesh.position.copy(this.state.position),e.add(this.mesh),this.boundingBox=new O,this.radius=o.PLAYER_RADIUS}createPlaceholderCat(){const e=new I,t=new w(.8,.6,1.2),s=new S({color:16753920}),i=new l(t,s);i.position.y=.3,e.add(i);const a=new A(.4,8,8),h=new l(a,s);h.position.set(0,.7,.5),e.add(h);const c=new C(.15,.3,4),p=new l(c,s);p.position.set(-.2,1,.5),e.add(p);const P=new l(c,s);P.position.set(.2,1,.5),e.add(P);const L=new T(.1,.05,.8,6),_=new l(L,s);_.position.set(0,.5,-.6),_.rotation.x=Math.PI/4,e.add(_);const H=new T(.1,.1,.5,6),D=new S({color:16747520});return[[-.3,0,.4],[.3,0,.4],[-.3,0,-.2],[.3,0,-.2]].forEach(([k,x,F])=>{const R=new l(H,D);R.position.set(k,x,F),e.add(R)}),e}update(e){this.state.isSliding&&(this.slideTimer-=e,this.slideTimer<=0&&this.endSlide()),(this.state.position.y>0||this.state.velocity.y>0)&&(this.state.velocity.y+=o.GRAVITY*e,this.state.position.y+=this.state.velocity.y*e,this.state.position.y<=(this.state.isSliding?o.SLIDE_HEIGHT:o.PLAYER_HEIGHT)&&(this.state.position.y=this.state.isSliding?o.SLIDE_HEIGHT:o.PLAYER_HEIGHT,this.state.velocity.y=0,this.state.isJumping=!1));const t=o.LANE_POSITIONS[this.state.targetLane],s=this.state.position.x;if(Math.abs(t-s)>.01){const i=Math.sign(t-s),a=o.LANE_SWITCH_SPEED*e;this.state.position.x+=i*Math.min(a,Math.abs(t-s)),this.state.lane=this.state.targetLane}else this.state.position.x=t,this.state.lane=this.state.targetLane;if(this.mesh.position.copy(this.state.position),!this.state.isJumping&&!this.state.isSliding){const i=Math.sin(Date.now()*.01)*.05;this.mesh.position.y+=i}this.mesh.rotation.y=0,this.boundingBox.setFromObject(this.mesh)}jump(){return!this.state.isJumping&&!this.state.isSliding&&this.state.position.y<=o.PLAYER_HEIGHT+.1?(this.state.velocity.y=o.JUMP_FORCE,this.state.isJumping=!0,this.state.currentAnimation=y.JUMP,!0):!1}slide(){return!this.state.isSliding&&!this.state.isJumping?(this.state.isSliding=!0,this.slideTimer=o.SLIDE_DURATION,this.state.currentAnimation=y.SLIDE,this.mesh.scale.y=.5,!0):!1}endSlide(){this.state.isSliding=!1,this.mesh.scale.y=1,this.state.currentAnimation=y.RUN}moveLeft(){return this.state.targetLane>0?(this.state.targetLane--,!0):!1}moveRight(){return this.state.targetLane<o.LANE_COUNT-1?(this.state.targetLane++,!0):!1}setInvincible(e){this.state.isInvincible=e,e?this.mesh.traverse(t=>{t instanceof l&&(t.material.emissive=new G(65535),t.material.emissiveIntensity=.5)}):this.mesh.traverse(t=>{t instanceof l&&(t.material.emissiveIntensity=0)})}hit(){this.state.currentAnimation=y.HIT,this.mesh.traverse(e=>{if(e instanceof l){const t=e.material.color.clone();e.material.color.set(16711680),setTimeout(()=>{e.material.color.copy(t)},200)}})}getState(){return{...this.state}}getLane(){return this.state.lane}isInvincible(){return this.state.isInvincible}get position(){return this.state.position}getBoundingBox(){return this.boundingBox}getRadius(){return this.radius}reset(){this.state.lane=o.PLAYER_START_LANE,this.state.targetLane=o.PLAYER_START_LANE,this.state.position.set(o.LANE_POSITIONS[o.PLAYER_START_LANE],o.PLAYER_HEIGHT,0),this.state.velocity.set(0,0,0),this.state.isJumping=!1,this.state.isSliding=!1,this.state.isInvincible=!1,this.mesh.scale.set(1,1,1)}dispose(){this.mesh.traverse(e=>{e instanceof l&&(e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(t=>t.dispose()):e.material.dispose())})}}class te{constructor(e){n(this,"mesh");n(this,"type");n(this,"lane",0);n(this,"active",!1);n(this,"boundingBox");n(this,"radius",.5);this.type=e,this.mesh=this.createObstacleMesh(e),this.boundingBox=new O,this.mesh.visible=!1}createObstacleMesh(e){const t=new S({color:m.OBSTACLE,roughness:.7,metalness:.2});let s,i;switch(e){case M.LOW:s=new w(1,.8,1),i=new l(s,t),i.position.y=.4;break;case M.MIDDLE:s=new w(1.5,.3,1.5),i=new l(s,t),i.position.y=1.5;const a=new T(.15,.15,1.5,8),h=t.clone(),c=new l(a,h);c.position.set(-.6,.75,0),i.add(c);const p=new l(a,h);p.position.set(.6,.75,0),i.add(p);break;case M.HIGH:default:s=new w(1.2,2,1.2),i=new l(s,t),i.position.y=1;break}return i.rotation.y=Math.random()*Math.PI*2,i}initialize(e,t){this.lane=e,this.mesh.position.x=o.LANE_POSITIONS[e],this.mesh.position.z=t,this.mesh.visible=!0,this.setActive(!0)}update(e){this.active&&this.boundingBox.setFromObject(this.mesh)}getType(){return this.type}getLane(){return this.lane}reset(){this.mesh.visible=!1,this.lane=0,this.active=!1}isActive(){return this.active}setActive(e){this.active=e,this.mesh.visible=e}get position(){return this.mesh.position}getBoundingBox(){return this.boundingBox}getRadius(){return this.radius}dispose(){this.mesh.traverse(e=>{e instanceof l&&(e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(t=>t.dispose()):e.material.dispose())})}}class se{constructor(e){n(this,"mesh");n(this,"type");n(this,"lane",0);n(this,"active",!1);n(this,"boundingBox");n(this,"radius",.3);n(this,"rotationSpeed");this.type=e,this.mesh=this.createCollectibleMesh(e),this.boundingBox=new O,this.mesh.visible=!1,this.rotationSpeed=2+Math.random()*2}createCollectibleMesh(e){const t=new I;switch(e){case d.COIN:{const s=new T(.3,.3,.1,16),i=new S({color:m.COIN,emissive:m.COIN,emissiveIntensity:.3,metalness:.8,roughness:.2}),a=new l(s,i);a.rotation.x=Math.PI/2,t.add(a);break}case d.FISH:{const s=new A(.4,8,8),i=new S({color:m.FISH,emissive:m.FISH,emissiveIntensity:.3}),a=new l(s,i);a.scale.set(1,.7,1.5),t.add(a);const h=new C(.3,.5,4),c=new l(h,i);c.rotation.z=-Math.PI/2,c.position.x=-.6,t.add(c);break}case d.POWERUP_MAGNET:{const s=new Y(.3,.1,8,12),i=new S({color:m.POWERUP_MAGNET,emissive:m.POWERUP_MAGNET,emissiveIntensity:.5}),a=new l(s,i);t.add(a);const h=new A(.5,16,16),c=new v({color:m.POWERUP_MAGNET,transparent:!0,opacity:.2}),p=new l(h,c);t.add(p);break}case d.POWERUP_MULTIPLIER:{const s=new w(.5,.5,.5),i=new S({color:m.POWERUP_MULTIPLIER,emissive:m.POWERUP_MULTIPLIER,emissiveIntensity:.5}),a=new l(s,i);t.add(a);const h=new A(.6,16,16),c=new v({color:m.POWERUP_MULTIPLIER,transparent:!0,opacity:.2}),p=new l(h,c);t.add(p);break}case d.POWERUP_SHIELD:{const s=new z(.4,0),i=new S({color:m.POWERUP_SHIELD,emissive:m.POWERUP_SHIELD,emissiveIntensity:.5}),a=new l(s,i);t.add(a);const h=new A(.6,16,16),c=new v({color:m.POWERUP_SHIELD,transparent:!0,opacity:.2}),p=new l(h,c);t.add(p);break}}return t.position.y=1,t}initialize(e,t){this.lane=e,this.mesh.position.x=o.LANE_POSITIONS[e],this.mesh.position.z=t,this.mesh.visible=!0,this.setActive(!0)}update(e){if(!this.active)return;this.mesh.rotation.y+=this.rotationSpeed*e;const t=Math.sin(Date.now()*.003)*.2;this.mesh.position.y=1+t,this.boundingBox.setFromObject(this.mesh)}getType(){return this.type}getLane(){return this.lane}getValue(){switch(this.type){case d.COIN:return o.COIN_VALUE;case d.FISH:return o.FISH_VALUE;default:return 0}}isPowerUp(){return this.type===d.POWERUP_MAGNET||this.type===d.POWERUP_MULTIPLIER||this.type===d.POWERUP_SHIELD}reset(){this.mesh.visible=!1,this.mesh.rotation.set(0,0,0),this.lane=0,this.active=!1}isActive(){return this.active}setActive(e){this.active=e,this.mesh.visible=e}get position(){return this.mesh.position}getBoundingBox(){return this.boundingBox}getRadius(){return this.radius}dispose(){this.mesh.traverse(e=>{e instanceof l&&(e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(t=>t.dispose()):e.material.dispose())})}}class ie{constructor(){n(this,"segmentCounter",0);n(this,"difficulty",0)}generateSegment(){const e={obstacles:[],collectibles:[],difficulty:this.difficulty};return this.difficulty=Math.min(o.OBSTACLE_BASE_PROBABILITY+this.segmentCounter*o.DIFFICULTY_CURVE_RATE,o.OBSTACLE_MAX_PROBABILITY),this.generateObstacles(e),this.generateCollectibles(e),Math.random()<.15&&this.generatePowerUp(e),this.segmentCounter++,e}generateObstacles(e){const t=Math.random()<this.difficulty?this.getObstacleCount():0;if(t===0)return;const s=new Set;for(let i=0;i<t;i++){const a=this.randomObstacleType(),h=this.randomLane(),c=this.randomPositionInSegment(),p=`${h}-${Math.floor(c)}`;s.has(p)||(s.add(p),e.obstacles.push({type:a,lane:h,position:c}))}this.ensureSolvable(e)}ensureSolvable(e){if([0,1,2].filter(i=>!e.obstacles.some(a=>a.lane===i)).length===0){const i=this.randomLane();e.obstacles=e.obstacles.filter(a=>a.lane!==i)}}generateCollectibles(e){const t=Math.random();t<.3?this.generateCoinLine(e,this.randomLane()):t<.5?this.generateScatteredCoins(e):t<.7?this.generateZigZagCoins(e):t<.85?this.generateMultiLaneCoins(e):this.generateFish(e)}generateCoinLine(e,t){const s=5+Math.floor(Math.random()*5),i=o.SEGMENT_LENGTH/(s+1);for(let a=0;a<s;a++){const h=i*(a+1);this.isObstacleAt(e,t,h)||e.collectibles.push({type:d.COIN,lane:t,position:h})}}generateScatteredCoins(e){const t=3+Math.floor(Math.random()*5);for(let s=0;s<t;s++){const i=this.randomLane(),a=this.randomPositionInSegment();this.isObstacleAt(e,i,a)||e.collectibles.push({type:d.COIN,lane:i,position:a})}}generateZigZagCoins(e){let s=this.randomLane();for(let i=0;i<3;i++){const a=o.SEGMENT_LENGTH/3*i+3;e.collectibles.push({type:d.COIN,lane:s,position:a}),s=(s+(Math.random()<.5?1:-1)+3)%3}}generateMultiLaneCoins(e){for(let t=0;t<o.LANE_COUNT;t++){const s=this.randomPositionInSegment();this.isObstacleAt(e,t,s)||e.collectibles.push({type:d.COIN,lane:t,position:s})}}generateFish(e){const t=this.randomLane(),s=o.SEGMENT_LENGTH/2;this.isObstacleAt(e,t,s)||e.collectibles.push({type:d.FISH,lane:t,position:s})}generatePowerUp(e){const t=[d.POWERUP_MAGNET,d.POWERUP_MULTIPLIER,d.POWERUP_SHIELD],s=t[Math.floor(Math.random()*t.length)],i=this.randomLane(),a=this.randomPositionInSegment();this.isObstacleAt(e,i,a)||e.collectibles.push({type:s,lane:i,position:a})}isObstacleAt(e,t,s){return e.obstacles.some(i=>i.lane===t&&Math.abs(i.position-s)<2)}getObstacleCount(){const e=Math.random();return this.difficulty<.3?1:this.difficulty<.5?e<.7?1:2:e<.5?2:3}randomObstacleType(){const e=[M.LOW,M.MIDDLE,M.HIGH];return e[Math.floor(Math.random()*e.length)]}randomLane(){return Math.floor(Math.random()*o.LANE_COUNT)}randomPositionInSegment(){return 3+Math.random()*(o.SEGMENT_LENGTH-6)}reset(){this.segmentCounter=0,this.difficulty=0}getDifficulty(){return this.difficulty}getSegmentCount(){return this.segmentCounter}}class b{static checkAABBCollision(e,t){const s=e.getBoundingBox(),i=t.getBoundingBox();return s.intersectsBox(i)}static checkSphereCollision(e,t){const s=e.position.distanceTo(t.position),i=e.getRadius()+t.getRadius();return s<i}static checkLaneCollision(e,t,s,i,a=1.5){return e!==s?!1:Math.abs(t-i)<a}static getObjectsInRange(e,t,s){return t.filter(i=>e.distanceTo(i.position)<=s)}static raycast(e,t,s,i=1/0){return new X(e,t.normalize(),0,i).intersectObjects(s,!0)}static createBoundingBox(e){const t=new O;return t.setFromObject(e),t}static calculateRadius(e){const t=this.createBoundingBox(e),s=new N;return t.getSize(s),Math.max(s.x,s.y,s.z)/2}}class U{constructor(e,t=10,s=50){n(this,"pool",[]);n(this,"active",new Set);n(this,"factory");n(this,"maxSize");this.factory=e,this.maxSize=s;for(let i=0;i<t;i++){const a=this.factory();a.setActive(!1),this.pool.push(a)}}acquire(){let e;return this.pool.length>0?e=this.pool.pop():e=this.factory(),e.reset(),e.setActive(!0),this.active.add(e),e}release(e){this.active.has(e)&&(e.setActive(!1),this.active.delete(e),this.pool.length<this.maxSize?this.pool.push(e):e.dispose())}releaseAll(){Array.from(this.active).forEach(t=>this.release(t))}updateActive(e){this.active.forEach(t=>{t.isActive()&&t.update(e)})}getActive(){return Array.from(this.active)}getStats(){return{pooled:this.pool.length,active:this.active.size,total:this.pool.length+this.active.size}}dispose(){this.releaseAll(),this.pool.forEach(e=>e.dispose()),this.pool=[],this.active.clear()}}class ae{constructor(e){n(this,"scene");n(this,"camera");n(this,"renderer");n(this,"player");n(this,"levelGenerator");n(this,"obstaclePoolsMap",new Map);n(this,"collectiblePoolsMap",new Map);n(this,"worldGroup");n(this,"segments",[]);n(this,"currentSpeed",o.BASE_SPEED);n(this,"distanceTraveled",0);n(this,"onCollision");this.scene=new $,this.scene.background=new G(m.SKY_TOP),this.scene.fog=new V(m.SKY_BOTTOM,50,100),this.camera=new K(o.CAMERA_FOV,window.innerWidth/window.innerHeight,o.CAMERA_NEAR,o.CAMERA_FAR),this.renderer=new j({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.shadowMap.enabled=o.ENABLE_SHADOWS,this.renderer.shadowMap.type=J,e.appendChild(this.renderer.domElement),this.setupLights(),this.worldGroup=new I,this.scene.add(this.worldGroup),this.player=new ee(this.scene),this.updateCamera(),this.levelGenerator=new ie,this.initializeObjectPools(),this.generateInitialSegments(),window.addEventListener("resize",this.onWindowResize.bind(this))}setupLights(){const e=new Z(m.SKY_TOP,m.GROUND,.6);this.scene.add(e);const t=new q(16777215,.8);t.position.set(5,10,5),t.castShadow=o.ENABLE_SHADOWS,t.shadow.camera.left=-20,t.shadow.camera.right=20,t.shadow.camera.top=20,t.shadow.camera.bottom=-20,t.shadow.mapSize.width=o.SHADOW_MAP_SIZE,t.shadow.mapSize.height=o.SHADOW_MAP_SIZE,this.scene.add(t)}initializeObjectPools(){Object.values(M).forEach(e=>{const t=new U(()=>{const s=new te(e);return this.worldGroup.add(s.mesh),s},5,o.MAX_POOL_SIZE);this.obstaclePoolsMap.set(e,t)}),Object.values(d).forEach(e=>{const t=new U(()=>{const s=new se(e);return this.worldGroup.add(s.mesh),s},5,o.MAX_POOL_SIZE);this.collectiblePoolsMap.set(e,t)})}generateInitialSegments(){for(let e=0;e<o.INITIAL_SEGMENTS;e++)this.generateSegment(e*o.SEGMENT_LENGTH)}generateSegment(e){const t=new I;t.position.z=e;const s=new Q(o.LANE_WIDTH*o.LANE_COUNT+2,o.SEGMENT_LENGTH),i=new S({color:m.GROUND,roughness:.8}),a=new l(s,i);a.rotation.x=-Math.PI/2,a.position.z=o.SEGMENT_LENGTH/2,a.receiveShadow=o.ENABLE_SHADOWS,t.add(a);for(let c=0;c<=o.LANE_COUNT;c++){const p=new w(.1,.1,o.SEGMENT_LENGTH),P=new v({color:16777215,transparent:!0,opacity:.3}),L=new l(p,P);L.position.x=-3*o.LANE_COUNT/2+c*o.LANE_WIDTH,L.position.z=o.SEGMENT_LENGTH/2,t.add(L)}const h=this.levelGenerator.generateSegment();this.populateSegment(t,h),this.worldGroup.add(t),this.segments.push(t)}populateSegment(e,t){const s=e.position.z;t.obstacles.forEach(i=>{const a=this.obstaclePoolsMap.get(i.type);a&&a.acquire().initialize(i.lane,s+i.position)}),t.collectibles.forEach(i=>{const a=this.collectiblePoolsMap.get(i.type);a&&a.acquire().initialize(i.lane,s+i.position)})}update(e){this.player.update(e),this.updateWorldScroll(e),this.obstaclePoolsMap.forEach(t=>t.updateActive(e)),this.collectiblePoolsMap.forEach(t=>t.updateActive(e)),this.checkCollisions(),this.updateCamera()}updateWorldScroll(e){var a;const t=this.currentSpeed*e;this.worldGroup.position.z-=t,this.distanceTraveled+=t;const s=this.player.position.z-this.worldGroup.position.z,i=((a=this.segments[this.segments.length-1])==null?void 0:a.position.z)||0;for(i-s<o.SEGMENTS_AHEAD*o.SEGMENT_LENGTH&&this.generateSegment(i+o.SEGMENT_LENGTH);this.segments.length>0;){const h=this.segments[0];if(h.position.z<s-o.SEGMENT_LENGTH*2)this.worldGroup.remove(h),this.segments.shift(),h.traverse(c=>{c instanceof l&&(c.geometry.dispose(),Array.isArray(c.material)?c.material.forEach(p=>p.dispose()):c.material.dispose())});else break}this.releaseOldPooledObjects(s)}releaseOldPooledObjects(e){this.obstaclePoolsMap.forEach(t=>{t.getActive().forEach(s=>{s.position.z<e-o.SEGMENT_LENGTH&&t.release(s)})}),this.collectiblePoolsMap.forEach(t=>{t.getActive().forEach(s=>{s.position.z<e-o.SEGMENT_LENGTH&&t.release(s)})})}checkCollisions(){const e=this.player.getLane(),t=this.player.position.z;this.obstaclePoolsMap.forEach(s=>{s.getActive().forEach(i=>{var a;b.checkLaneCollision(e,t,i.getLane(),i.position.z)&&b.checkSphereCollision(this.player,i)&&((a=this.onCollision)==null||a.call(this,"obstacle",i),s.release(i))})}),this.collectiblePoolsMap.forEach(s=>{s.getActive().forEach(i=>{var a;b.checkLaneCollision(e,t,i.getLane(),i.position.z,2)&&b.checkSphereCollision(this.player,i)&&((a=this.onCollision)==null||a.call(this,"collectible",i),s.release(i))})})}updateCamera(){this.camera.position.x=this.player.position.x,this.camera.position.y=this.player.position.y+o.CAMERA_OFFSET_Y,this.camera.position.z=this.player.position.z+o.CAMERA_OFFSET_Z,this.camera.lookAt(this.player.position.x,this.player.position.y+1,this.player.position.z+o.CAMERA_LOOK_AHEAD)}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}setSpeed(e){this.currentSpeed=e}getPlayer(){return this.player}setCollisionCallback(e){this.onCollision=e}render(){this.renderer.render(this.scene,this.camera)}reset(){this.player.reset(),this.obstaclePoolsMap.forEach(e=>e.releaseAll()),this.collectiblePoolsMap.forEach(e=>e.releaseAll()),this.segments.forEach(e=>{this.worldGroup.remove(e)}),this.segments=[],this.worldGroup.position.set(0,0,0),this.distanceTraveled=0,this.levelGenerator.reset(),this.generateInitialSegments(),this.currentSpeed=o.BASE_SPEED}dispose(){window.removeEventListener("resize",this.onWindowResize.bind(this)),this.player.dispose(),this.obstaclePoolsMap.forEach(e=>e.dispose()),this.collectiblePoolsMap.forEach(e=>e.dispose()),this.scene.traverse(e=>{e instanceof l&&(e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(t=>t.dispose()):e.material.dispose())}),this.renderer.dispose()}}class ne{constructor(){n(this,"inputState",{left:!1,right:!1,jump:!1,slide:!1,pause:!1});n(this,"touchState",{startX:0,startY:0,endX:0,endY:0,startTime:0,isSwiping:!1});n(this,"SWIPE_THRESHOLD",50);n(this,"SWIPE_MAX_TIME",500);n(this,"keydownHandler");n(this,"keyupHandler");n(this,"touchstartHandler");n(this,"touchmoveHandler");n(this,"touchendHandler");n(this,"isGamePlaying",!1);this.keydownHandler=this.onKeyDown.bind(this),this.keyupHandler=this.onKeyUp.bind(this),this.touchstartHandler=this.onTouchStart.bind(this),this.touchmoveHandler=this.onTouchMove.bind(this),this.touchendHandler=this.onTouchEnd.bind(this),this.setupEventListeners()}setupEventListeners(){window.addEventListener("keydown",this.keydownHandler),window.addEventListener("keyup",this.keyupHandler),window.addEventListener("touchstart",this.touchstartHandler,{passive:!1}),window.addEventListener("touchmove",this.touchmoveHandler,{passive:!1}),window.addEventListener("touchend",this.touchendHandler,{passive:!1})}onKeyDown(e){switch(e.code){case"ArrowLeft":case"KeyA":this.inputState.left=!0,e.preventDefault();break;case"ArrowRight":case"KeyD":this.inputState.right=!0,e.preventDefault();break;case"Space":case"ArrowUp":case"KeyW":this.inputState.jump=!0,e.preventDefault();break;case"ShiftLeft":case"ShiftRight":case"ArrowDown":case"KeyS":this.inputState.slide=!0,e.preventDefault();break;case"Escape":case"KeyP":this.inputState.pause=!0,e.preventDefault();break}}onKeyUp(e){switch(e.code){case"ArrowLeft":case"KeyA":this.inputState.left=!1;break;case"ArrowRight":case"KeyD":this.inputState.right=!1;break;case"Space":case"ArrowUp":case"KeyW":this.inputState.jump=!1;break;case"ShiftLeft":case"ShiftRight":case"ArrowDown":case"KeyS":this.inputState.slide=!1;break;case"Escape":case"KeyP":this.inputState.pause=!1;break}}onTouchStart(e){if(!this.isGamePlaying)return;e.preventDefault();const t=e.touches[0];this.touchState.startX=t.clientX,this.touchState.startY=t.clientY,this.touchState.startTime=Date.now(),this.touchState.isSwiping=!0}onTouchMove(e){if(!this.isGamePlaying||(e.preventDefault(),!this.touchState.isSwiping))return;const t=e.touches[0];this.touchState.endX=t.clientX,this.touchState.endY=t.clientY}onTouchEnd(e){if(!this.isGamePlaying||(e.preventDefault(),!this.touchState.isSwiping))return;const t=this.touchState.endX-this.touchState.startX,s=this.touchState.endY-this.touchState.startY;if(Date.now()-this.touchState.startTime<this.SWIPE_MAX_TIME){const a=Math.abs(t),h=Math.abs(s);(a>this.SWIPE_THRESHOLD||h>this.SWIPE_THRESHOLD)&&(a>h?t>0?this.triggerAction("right"):this.triggerAction("left"):s<0?this.triggerAction("jump"):this.triggerAction("slide"))}this.touchState.isSwiping=!1}triggerAction(e){this.inputState[e]=!0,setTimeout(()=>{this.inputState[e]=!1},100)}getInputState(){return this.inputState}isInputActive(e){return this.inputState[e]}reset(){this.inputState={left:!1,right:!1,jump:!1,slide:!1,pause:!1}}setGamePlaying(e){this.isGamePlaying=e}dispose(){window.removeEventListener("keydown",this.keydownHandler),window.removeEventListener("keyup",this.keyupHandler),window.removeEventListener("touchstart",this.touchstartHandler),window.removeEventListener("touchmove",this.touchmoveHandler),window.removeEventListener("touchend",this.touchendHandler)}}class oe{constructor(){n(this,"stats",{score:0,distance:0,coins:0,totalCoins:0,multiplier:1,combo:0,speed:o.BASE_SPEED,segmentsPassed:0});n(this,"comboTimer",0);n(this,"listeners",new Map);this.reset()}update(e){const t=this.stats.speed*e/10;this.stats.distance+=t,this.stats.score+=Math.floor(t*o.SCORE_PER_METER*this.stats.multiplier),this.stats.combo>0&&(this.comboTimer-=e*1e3,this.comboTimer<=0&&this.resetCombo()),this.emit("distanceChange",Math.floor(this.stats.distance)),this.emit("scoreChange",this.stats.score)}addScore(e){const t=Math.floor(e*this.stats.multiplier);this.stats.score+=t,this.emit("scoreChange",this.stats.score)}collectCoin(e=o.COIN_VALUE){this.stats.coins++,this.stats.totalCoins++,this.addScore(e),this.incrementCombo(),this.emit("coinCollect",this.stats.coins)}collectFish(e=o.FISH_VALUE){this.stats.coins+=5,this.stats.totalCoins+=5,this.addScore(e),this.incrementCombo(),this.emit("coinCollect",this.stats.coins)}incrementCombo(){if(this.stats.combo++,this.comboTimer=o.COMBO_TIMEOUT,this.stats.combo>5){const e=Math.floor(this.stats.combo/5)*10;this.addScore(e)}}resetCombo(){this.stats.combo=0,this.comboTimer=0}setMultiplier(e){this.stats.multiplier=e}setSpeed(e){this.stats.speed=e}incrementSegments(){this.stats.segmentsPassed++}getStats(){return{...this.stats}}getStat(e){return this.stats[e]}reset(){const e=this.stats.totalCoins;this.stats={score:0,distance:0,coins:0,totalCoins:e,multiplier:1,combo:0,speed:o.BASE_SPEED,segmentsPassed:0},this.comboTimer=0}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}emit(e,...t){const s=this.listeners.get(e);s&&s.forEach(i=>i(...t))}saveHighScore(){const e=this.getHighScore();return this.stats.score>e?(localStorage.setItem("cat-runrun-highscore",this.stats.score.toString()),this.stats.score):e}getHighScore(){const e=localStorage.getItem("cat-runrun-highscore");return e?parseInt(e,10):0}saveTotalCoins(){localStorage.setItem("cat-runrun-totalcoins",this.stats.totalCoins.toString())}loadTotalCoins(){const e=localStorage.getItem("cat-runrun-totalcoins");this.stats.totalCoins=e?parseInt(e,10):0}}class re{constructor(){n(this,"powerUps",new Map);n(this,"listeners",new Map);this.initializePowerUps()}initializePowerUps(){this.powerUps.set(u.MAGNET,{type:u.MAGNET,duration:o.MAGNET_DURATION,remainingTime:0,active:!1}),this.powerUps.set(u.MULTIPLIER,{type:u.MULTIPLIER,duration:o.MULTIPLIER_DURATION,remainingTime:0,active:!1}),this.powerUps.set(u.SHIELD,{type:u.SHIELD,duration:o.SHIELD_DURATION,remainingTime:0,active:!1})}update(e){this.powerUps.forEach((t,s)=>{t.active&&(t.remainingTime-=e,t.remainingTime<=0?this.deactivatePowerUp(s):this.emit("powerUpUpdate",s,t.remainingTime))})}activatePowerUp(e){const t=this.powerUps.get(e);t&&(t.active?t.remainingTime=Math.min(t.remainingTime+t.duration,t.duration*2):(t.active=!0,t.remainingTime=t.duration,this.emit("powerUpActivate",e)))}deactivatePowerUp(e){const t=this.powerUps.get(e);t&&(t.active=!1,t.remainingTime=0,this.emit("powerUpExpire",e))}isActive(e){const t=this.powerUps.get(e);return t?t.active:!1}getRemainingTime(e){const t=this.powerUps.get(e);return t?t.remainingTime:0}getActivePowerUps(){const e=[];return this.powerUps.forEach((t,s)=>{t.active&&e.push(s)}),e}hasShield(){return this.isActive(u.SHIELD)}hasMagnet(){return this.isActive(u.MAGNET)}hasMultiplier(){return this.isActive(u.MULTIPLIER)}getScoreMultiplier(){return this.hasMultiplier()?2:1}reset(){this.powerUps.forEach(e=>{e.active=!1,e.remainingTime=0})}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}emit(e,...t){const s=this.listeners.get(e);s&&s.forEach(i=>i(...t))}}class he{constructor(){n(this,"sounds",new Map);n(this,"bgm",null);n(this,"settings",{musicEnabled:!0,musicVolume:.5,sfxEnabled:!0,sfxVolume:.7});n(this,"initialized",!1);this.loadSettings()}async init(){if(!this.initialized){console.log("ðŸŽµ Initializing audio system...");try{console.log("Loading BGM from:",f.SOUNDS.BGM),this.bgm=await this.loadAudio(f.SOUNDS.BGM),this.bgm.loop=!0,this.bgm.volume=this.settings.musicVolume,console.log("âœ“ BGM loaded"),console.log("Loading sound effects..."),await Promise.all([this.loadSound("jump",f.SOUNDS.JUMP),this.loadSound("coin",f.SOUNDS.COIN),this.loadSound("fish",f.SOUNDS.FISH),this.loadSound("hit",f.SOUNDS.HIT),this.loadSound("powerup",f.SOUNDS.POWERUP)]),this.initialized=!0,console.log("âœ… Audio system initialized successfully"),console.log("Loaded sounds:",Array.from(this.sounds.keys()))}catch(e){console.error("âŒ Audio initialization failed:",e),this.initialized=!0}}}async loadAudio(e){return new Promise(t=>{const s=new Audio;s.addEventListener("canplaythrough",()=>t(s),{once:!0}),s.addEventListener("error",i=>{console.warn(`Failed to load audio: ${e}`,i),t(s)}),s.src=e,s.load()})}async loadSound(e,t){const s=await this.loadAudio(t);s.volume=this.settings.sfxVolume,this.sounds.set(e,s)}playSFX(e){if(!this.settings.sfxEnabled)return;const t=this.sounds.get(e);if(t){const s=t.cloneNode();s.volume=this.settings.sfxVolume,s.play().catch(i=>console.warn("Failed to play sound:",e,i))}}playMusic(){if(!this.settings.musicEnabled){console.log("Music disabled");return}if(!this.bgm){console.warn("âš ï¸ BGM not loaded");return}console.log("ðŸŽµ Attempting to play music..."),this.bgm.currentTime=0,this.bgm.play().then(()=>console.log("âœ… Music playing")).catch(e=>{console.warn("âŒ Failed to play music (browser autoplay policy):",e.message),console.log("ðŸ’¡ Music will play after user interaction")})}stopMusic(){this.bgm&&(this.bgm.pause(),this.bgm.currentTime=0)}pauseMusic(){this.bgm&&this.bgm.pause()}resumeMusic(){this.settings.musicEnabled&&this.bgm&&this.bgm.play().catch(e=>console.warn("Failed to resume music",e))}setMusicVolume(e){this.settings.musicVolume=Math.max(0,Math.min(1,e)),this.bgm&&(this.bgm.volume=this.settings.musicVolume),this.saveSettings()}setSFXVolume(e){this.settings.sfxVolume=Math.max(0,Math.min(1,e)),this.sounds.forEach(t=>{t.volume=this.settings.sfxVolume}),this.saveSettings()}toggleMusic(e){this.settings.musicEnabled=e!==void 0?e:!this.settings.musicEnabled,this.settings.musicEnabled?this.playMusic():this.stopMusic(),this.saveSettings()}toggleSFX(e){this.settings.sfxEnabled=e!==void 0?e:!this.settings.sfxEnabled,this.saveSettings()}getSettings(){return{...this.settings}}saveSettings(){localStorage.setItem("cat-runrun-audio",JSON.stringify(this.settings))}loadSettings(){const e=localStorage.getItem("cat-runrun-audio");if(e)try{this.settings=JSON.parse(e)}catch(t){console.warn("Failed to load audio settings",t)}}dispose(){this.stopMusic(),this.sounds.clear(),this.bgm=null}}class le{constructor(){n(this,"mainMenu");n(this,"tutorialMenu");n(this,"shopMenu");n(this,"leaderboardMenu");n(this,"gameoverMenu");n(this,"pauseMenu");n(this,"loadingScreen");n(this,"hud");n(this,"hudScore");n(this,"hudDistance");n(this,"hudCoins");n(this,"powerupMagnet");n(this,"powerupMultiplier");n(this,"powerupShield");n(this,"callbacks",new Map);this.mainMenu=this.getElement("main-menu"),this.tutorialMenu=this.getElement("tutorial-menu"),this.shopMenu=this.getElement("shop-menu"),this.leaderboardMenu=this.getElement("leaderboard-menu"),this.gameoverMenu=this.getElement("gameover-menu"),this.pauseMenu=this.getElement("pause-menu"),this.loadingScreen=this.getElement("loading-screen"),this.hud=this.getElement("hud"),this.hudScore=this.getElement("hud-score"),this.hudDistance=this.getElement("hud-distance"),this.hudCoins=this.getElement("hud-coins"),this.powerupMagnet=this.getElement("powerup-magnet"),this.powerupMultiplier=this.getElement("powerup-multiplier"),this.powerupShield=this.getElement("powerup-shield"),this.setupEventListeners()}getElement(e){const t=document.getElementById(e);if(!t)throw new Error(`UI element not found: ${e}`);return t}setupEventListeners(){this.getElement("btn-start").addEventListener("click",()=>this.emit("startGame")),this.getElement("btn-tutorial").addEventListener("click",()=>this.showTutorial()),this.getElement("btn-leaderboard").addEventListener("click",()=>this.showLeaderboard()),this.getElement("btn-shop").addEventListener("click",()=>this.showShop()),this.getElement("btn-back-tutorial").addEventListener("click",()=>this.showMainMenu()),this.getElement("btn-back-shop").addEventListener("click",()=>this.showMainMenu()),this.getElement("btn-back-leaderboard").addEventListener("click",()=>this.showMainMenu()),this.getElement("btn-restart").addEventListener("click",()=>this.emit("restart")),this.getElement("btn-menu").addEventListener("click",()=>{this.showMainMenu(),this.emit("returnToMenu")}),this.getElement("btn-share").addEventListener("click",()=>this.shareScore()),this.getElement("btn-resume").addEventListener("click",()=>this.emit("resume")),this.getElement("btn-quit").addEventListener("click",()=>{this.showMainMenu(),this.emit("quit")});const e=this.getElement("toggle-music"),t=this.getElement("toggle-sfx");e.addEventListener("change",()=>{this.emit("toggleMusic",e.checked)}),t.addEventListener("change",()=>{this.emit("toggleSFX",t.checked)})}showMainMenu(){this.hideAllMenus(),this.mainMenu.classList.add("active"),this.hud.classList.add("hidden")}showTutorial(){this.hideAllMenus(),this.tutorialMenu.classList.add("active")}showShop(){this.hideAllMenus(),this.shopMenu.classList.add("active"),this.populateShop()}showLeaderboard(){this.hideAllMenus(),this.leaderboardMenu.classList.add("active"),this.populateLeaderboard()}showGameOver(e,t){this.hideAllMenus(),this.hud.classList.add("hidden"),this.gameoverMenu.classList.add("active"),this.getElement("final-score").textContent=e.score.toString(),this.getElement("final-distance").textContent=Math.floor(e.distance)+"m",this.getElement("final-coins").textContent=e.coins.toString(),this.getElement("best-score").textContent=t.toString()}showPauseMenu(){this.pauseMenu.classList.add("active")}hidePauseMenu(){this.pauseMenu.classList.remove("active")}showHUD(){this.hideAllMenus(),this.hud.classList.remove("hidden")}hideAllMenus(){[this.mainMenu,this.tutorialMenu,this.shopMenu,this.leaderboardMenu,this.gameoverMenu,this.pauseMenu].forEach(e=>e.classList.remove("active"))}updateScore(e){this.hudScore.textContent=e.toString()}updateDistance(e){this.hudDistance.textContent=Math.floor(e)+"m"}updateCoins(e){this.hudCoins.textContent=e.toString()}showPowerUp(e,t){let s;switch(e){case u.MAGNET:s=this.powerupMagnet;break;case u.MULTIPLIER:s=this.powerupMultiplier;break;case u.SHIELD:s=this.powerupShield;break}s.classList.remove("hidden"),this.updatePowerUpTimer(e,t)}hidePowerUp(e){let t;switch(e){case u.MAGNET:t=this.powerupMagnet;break;case u.MULTIPLIER:t=this.powerupMultiplier;break;case u.SHIELD:t=this.powerupShield;break}t.classList.add("hidden")}updatePowerUpTimer(e,t){let s;switch(e){case u.MAGNET:s=this.powerupMagnet;break;case u.MULTIPLIER:s=this.powerupMultiplier;break;case u.SHIELD:s=this.powerupShield;break}const i=s.querySelector(".powerup-timer");i&&(i.textContent=Math.ceil(t)+"s")}updateLoadingProgress(e,t){const s=this.getElement("loading-progress");s.style.width=`${e*100}%`,t&&(this.getElement("loading-text").textContent=t)}hideLoadingScreen(){this.loadingScreen.classList.add("hidden")}populateShop(){const e=this.getElement("skins-list");e.innerHTML="",[{id:"orange",name:"Orange Cat",price:0,unlocked:!0,color:16753920},{id:"white",name:"White Cat",price:100,unlocked:!1,color:16777215},{id:"black",name:"Black Cat",price:200,unlocked:!1,color:0},{id:"tabby",name:"Tabby Cat",price:300,unlocked:!1,color:9127187},{id:"calico",name:"Calico Cat",price:500,unlocked:!1,color:16737095},{id:"siamese",name:"Siamese Cat",price:750,unlocked:!1,color:16113331}].forEach(s=>{var a;const i=document.createElement("div");i.className="skin-item",s.unlocked||i.classList.add("locked"),i.innerHTML=`
        <div class="skin-preview" style="background-color: #${(a=s.color)==null?void 0:a.toString(16).padStart(6,"0")}"></div>
        <div class="skin-name">${s.name}</div>
        <div class="skin-price">${s.unlocked?"Owned":s.price+" coins"}</div>
      `,i.addEventListener("click",()=>{s.unlocked&&this.emit("selectSkin",s.id)}),e.appendChild(i)})}populateLeaderboard(){const e=this.getElement("leaderboard-list");e.innerHTML="",[{rank:1,playerName:"Player 1",score:5e3,distance:500,date:"2025-12-08"},{rank:2,playerName:"Player 2",score:4500,distance:450,date:"2025-12-07"},{rank:3,playerName:"Player 3",score:4e3,distance:400,date:"2025-12-06"},{rank:4,playerName:"Player 4",score:3500,distance:350,date:"2025-12-05"},{rank:5,playerName:"Player 5",score:3e3,distance:300,date:"2025-12-04"}].forEach(s=>{const i=document.createElement("div");i.className="leaderboard-item",s.rank<=3&&i.classList.add("top-3"),i.innerHTML=`
        <div class="leaderboard-rank">#${s.rank}</div>
        <div class="leaderboard-player">${s.playerName}</div>
        <div class="leaderboard-score">${s.score}</div>
      `,e.appendChild(i)})}async shareScore(){const e=this.getElement("final-score").textContent,t=this.getElement("final-distance").textContent;if(navigator.share)try{await navigator.share({title:"Cat Run Run",text:`I scored ${e} points and ran ${t} in Cat Run Run!`,url:window.location.href})}catch(s){console.log("Share cancelled or failed",s)}else{const s=`I scored ${e} points and ran ${t} in Cat Run Run!`;navigator.clipboard.writeText(s).then(()=>{alert("Score copied to clipboard!")})}}on(e,t){this.callbacks.set(e,t)}emit(e,...t){const s=this.callbacks.get(e);s&&s(...t)}}class ce{constructor(e){n(this,"gameScene");n(this,"inputManager");n(this,"scoreSystem");n(this,"powerUpSystem");n(this,"audioManager");n(this,"uiManager");n(this,"state",E.LOADING);n(this,"lastTime",0);n(this,"animationFrameId",0);n(this,"gameLoop",()=>{if(this.state!==E.PLAYING)return;const e=performance.now(),t=Math.min((e-this.lastTime)/1e3,.1);this.lastTime=e,this.handleInput(),this.update(t),this.gameScene.render(),this.animationFrameId=requestAnimationFrame(this.gameLoop)});this.gameScene=new ae(e),this.inputManager=new ne,this.scoreSystem=new oe,this.powerUpSystem=new re,this.audioManager=new he,this.uiManager=new le,this.setupCallbacks(),this.init()}async init(){try{await this.audioManager.init(),this.uiManager.updateLoadingProgress(.5,"Loading audio..."),this.uiManager.updateLoadingProgress(1,"Ready!"),await new Promise(e=>setTimeout(e,500)),this.uiManager.hideLoadingScreen(),this.setState(E.MENU),this.uiManager.showMainMenu()}catch(e){console.error("Failed to initialize game:",e),alert("Failed to load game. Please refresh the page.")}}setupCallbacks(){this.uiManager.on("startGame",()=>this.startGame()),this.uiManager.on("restart",()=>this.restartGame()),this.uiManager.on("resume",()=>this.resumeGame()),this.uiManager.on("quit",()=>this.quitToMenu()),this.uiManager.on("returnToMenu",()=>this.quitToMenu()),this.uiManager.on("toggleMusic",e=>this.audioManager.toggleMusic(e)),this.uiManager.on("toggleSFX",e=>this.audioManager.toggleSFX(e)),this.scoreSystem.on("scoreChange",e=>this.uiManager.updateScore(e)),this.scoreSystem.on("distanceChange",e=>this.uiManager.updateDistance(e)),this.scoreSystem.on("coinCollect",e=>this.uiManager.updateCoins(e)),this.powerUpSystem.on("powerUpActivate",e=>{this.onPowerUpActivate(e)}),this.powerUpSystem.on("powerUpExpire",e=>{this.onPowerUpExpire(e)}),this.powerUpSystem.on("powerUpUpdate",(e,t)=>{this.uiManager.updatePowerUpTimer(e,t)}),this.gameScene.setCollisionCallback((e,t)=>{this.handleCollision(e,t)})}setState(e){const t=this.state;this.state=e,console.log(`Game state: ${t} -> ${e}`)}startGame(){this.setState(E.PLAYING),this.uiManager.showHUD(),this.gameScene.reset(),this.scoreSystem.reset(),this.powerUpSystem.reset(),this.inputManager.reset(),this.inputManager.setGamePlaying(!0),this.scoreSystem.loadTotalCoins(),this.audioManager.playMusic(),this.lastTime=performance.now(),this.gameLoop()}restartGame(){this.startGame()}resumeGame(){this.setState(E.PLAYING),this.uiManager.hidePauseMenu(),this.audioManager.resumeMusic(),this.inputManager.setGamePlaying(!0),this.lastTime=performance.now(),this.gameLoop()}quitToMenu(){this.setState(E.MENU),this.audioManager.stopMusic(),this.inputManager.setGamePlaying(!1),cancelAnimationFrame(this.animationFrameId)}pauseGame(){this.state===E.PLAYING&&(this.setState(E.PAUSED),this.uiManager.showPauseMenu(),this.audioManager.pauseMusic(),this.inputManager.setGamePlaying(!1),cancelAnimationFrame(this.animationFrameId))}gameOver(){this.setState(E.GAME_OVER),this.inputManager.setGamePlaying(!1);const e=this.scoreSystem.saveHighScore();this.scoreSystem.saveTotalCoins(),this.uiManager.showGameOver(this.scoreSystem.getStats(),e),this.audioManager.playSFX("hit"),this.audioManager.stopMusic(),cancelAnimationFrame(this.animationFrameId)}handleInput(){const e=this.inputManager.getInputState(),t=this.gameScene.getPlayer();e.left?(t.moveLeft()&&this.audioManager.playSFX("jump"),this.inputManager.reset()):e.right&&(t.moveRight()&&this.audioManager.playSFX("jump"),this.inputManager.reset()),e.jump&&(t.jump()&&this.audioManager.playSFX("jump"),this.inputManager.reset()),e.slide&&(t.slide()&&this.audioManager.playSFX("jump"),this.inputManager.reset()),e.pause&&(this.pauseGame(),this.inputManager.reset())}update(e){this.gameScene.update(e),this.scoreSystem.update(e),this.powerUpSystem.update(e),this.updateGameSpeed(),this.gameScene.getPlayer().setInvincible(this.powerUpSystem.hasShield()),this.powerUpSystem.hasMagnet(),this.scoreSystem.setMultiplier(this.powerUpSystem.getScoreMultiplier())}updateGameSpeed(){const e=this.scoreSystem.getStat("segmentsPassed"),t=Math.floor(e/o.SPEED_INCREMENT_INTERVAL),s=Math.min(o.BASE_SPEED+t*o.SPEED_INCREMENT,o.MAX_SPEED);this.scoreSystem.setSpeed(s),this.gameScene.setSpeed(s)}handleCollision(e,t){if(e==="obstacle"){const s=this.gameScene.getPlayer();s.isInvincible()||(s.hit(),this.gameOver())}else if(e==="collectible")switch(t.getType()){case d.COIN:this.scoreSystem.collectCoin(),this.audioManager.playSFX("coin");break;case d.FISH:this.scoreSystem.collectFish(),this.audioManager.playSFX("fish");break;case d.POWERUP_MAGNET:this.powerUpSystem.activatePowerUp(u.MAGNET),this.audioManager.playSFX("powerup");break;case d.POWERUP_MULTIPLIER:this.powerUpSystem.activatePowerUp(u.MULTIPLIER),this.audioManager.playSFX("powerup");break;case d.POWERUP_SHIELD:this.powerUpSystem.activatePowerUp(u.SHIELD),this.audioManager.playSFX("powerup");break}}onPowerUpActivate(e){const t=this.powerUpSystem.getRemainingTime(e);this.uiManager.showPowerUp(e,t)}onPowerUpExpire(e){this.uiManager.hidePowerUp(e)}dispose(){cancelAnimationFrame(this.animationFrameId),this.gameScene.dispose(),this.inputManager.dispose(),this.audioManager.dispose()}}document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("game-container");if(!r){console.error("Game container not found!");return}const e=new ce(r);document.addEventListener("visibilitychange",()=>{document.hidden?console.log("Page hidden"):console.log("Page visible")}),window.game=e,console.log("Cat Run Run initialized!")});
//# sourceMappingURL=index-C3Wn-9gN.js.map
